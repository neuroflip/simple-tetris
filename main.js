(()=>{"use strict";const e=class{constructor(e){this.canvasContext=e,this.position={x:0,y:0},this.piece=[]}render(){for(let e=0;e<this.piece.length;e++)for(let t=0;t<this.piece[e].length;t++)if(1===this.piece[e][t]){const i=this.position.x,n=this.position.y;w.drawPexel(this.canvasContext,i+t*d,n+e*u,d)}}rotateRigth(){const e=[];for(let t=0;t<this.piece[0].length;t++){const i=[];for(let e=this.piece.length-1;e>=0;e--)i.push(this.piece[e][t]);e.push(i)}this.piece=e}moveDown(){this.position.y+=u}moveLeft(){this.position.x-=d}moveRigth(){this.position.x+=d}checkCollision(){}},t=class extends e{constructor(e){super(e),this.piece=[],this.piece.push([1,1,1,1])}},i=class extends e{constructor(e){super(e),this.piece=[],this.piece.push([0,1,0]),this.piece.push([1,1,1])}},n=class extends e{constructor(e){super(e),this.piece=[],this.piece.push([1,1]),this.piece.push([1,1])}},o=class extends e{constructor(e){super(e),this.piece=[],this.piece.push([1,0]),this.piece.push([1,1]),this.piece.push([0,1])}},s=class extends e{constructor(e){super(e),this.piece=[],this.piece.push([1,1]),this.piece.push([1,0]),this.piece.push([1,0])}},h=class extends e{constructor(e){super(e),this.piece=[],this.piece.push([0,1]),this.piece.push([1,1]),this.piece.push([1,0])}},c=class extends e{constructor(e){super(e),this.piece=[],this.piece.push([1,1]),this.piece.push([0,1]),this.piece.push([0,1])}},r={drawPexel(e,t,i,n,o=0){e.save(),e.translate(t+n/2,i+n/2),o&&(e.scale(o,o),e.rotate(.35*o)),e.shadowColor="white",e.shadowBlur=10*o,e.beginPath(),e.moveTo(-n/2,n/2),e.lineTo(n/2,n/2),e.lineTo(n/2,-n/2),e.lineTo(-n/2,-n/2),e.lineTo(-n/2,n/2),e.lineTo(n/2,-n/2),e.fill(),e.restore()},drawPexelsLine(e,t,i,n,o){for(let n=0;n<a;n++)this.drawPexel(e,t+n*d,i,d,o)},getPieceDataCopied(e){const t=new e.__proto__.constructor;return t.position={...e.position},t.piece=[...e.piece],t},getRandomPiece:e=>new([t,n,i,o,s,h,c][Math.floor(7*Math.random())])(e),createTouchDivAndAddToParent(e,t){let i=document.createElement("div");i.classList.add(e,"touch-cell"),t.appendChild(i)},isMobile(){const e=navigator.userAgent;return e.match(/Android/i)||e.match(/BlackBerry/i)||e.match(/iPhone|iPad|iPod/i)||e.match(/Opera Mini/i)||e.match(/IEMobile/i)}},a=10,l=16,d=32,u=32,w=r,p=class{constructor(e,t,i,n){setTimeout(function(){this.destroy()}.bind(this),500),this.frame=0,this.x=t,this.y=i,this.onDestroy=n,this.canvasContext=e}render(){this.frame+=.05,w.drawPexelsLine(this.canvasContext,this.x,this.y,d,this.frame)}destroy(){this.onDestroy()}},m=class{constructor(e){this.animations=[],this.canvasContext=e}createRemoveLineAnimation(e,t){this.animations.unshift(new p(this.canvasContext,e,t,this.destroyLineAnimation.bind(this)))}destroyLineAnimation(){this.animations.pop()}render(){this.animations.length&&this.animations.forEach((e=>{e.render()}))}};function v(e){for(let t=0;t<this.screenArray.length;t++)this.screenArray[t]=new Array(e).fill(0)}const y=class{constructor(e,t){this.canvasContext=e,this.screenArray=new Array(l),v.call(this,a),this.animationController=new m(this.canvasContext),this.onCompleteLine=t}getValue(e,t){return this.screenArray[e][t]}setValue(e,t,i){return this.screenArray[e][t]=i}render(){for(let e=0;e<this.screenArray.length;e++)if(!this.checkCompleteLine(e))for(let t=0;t<this.screenArray[e].length;t++)1===this.screenArray[e][t]&&w.drawPexel(this.canvasContext,t*d,e*d,d);this.animationController.render()}checkCompleteLine(e){let t=!1,i=0;for(;!t&&i<this.screenArray[e].length;)0===this.screenArray[e][i]?t=!0:i++;return!t}consolidatePiece(e){const t=e.piece,i=e.position.x/d,n=e.position.y/d;for(let e=0;e<t.length;e++)for(let o=0;o<t[e].length;o++)1===t[e][o]&&this.setValue(e+n,o+i,1)}removeCompleteLines(){for(let e=this.screenArray.length-1;e>=0;e--)this.checkCompleteLine(e)&&(this.animationController.createRemoveLineAnimation(0,e*d),this.onCompleteLine());setTimeout(function(){for(let e=this.screenArray.length-1;e>=0;e--)this.checkCompleteLine(e)&&(this.removeLine(e),clearInterval(this.timer),this.timer=setInterval(this.bindedMoveDown,this.speed),e++)}.bind(this),500)}removeLine(e){let t=e;for(;t>0;)this.screenArray[t]=this.screenArray[t-1],t--;this.screenArray[0]=new Array(a).fill(0)}},T=class{constructor(e,t,i,n){this.onMoveDown=n,this.onMoveLeft=e,this.onMoveRight=t,this.onMoveUp=i,window.keyDown=window.keyDown||{},document.onkeydown=function(e){e=e||window.event,window.keyDown[e.keyCode]=!0},document.onkeyup=function(e){e=e||window.event,window.keyDown[e.keyCode]=!1}}},g=window.innerWidth/3,f=window.innerHeight/3,A=class{constructor(){this.startTimeStamp=new Date,this.lastTouchMoveX=0,this.lastTouchMoveY=0,this.baseTouchMoveX=0,this.baseTouchMoveY=0,this.currentBaseTouch=null,window.keyDown=window.keyDown||{};const e=document.createElement("div");e.classList.add("touch-cell-container"),w.createTouchDivAndAddToParent("touch-leftTop",e),w.createTouchDivAndAddToParent("touch-top",e),w.createTouchDivAndAddToParent("touch-rightTop",e),w.createTouchDivAndAddToParent("touch-left",e),w.createTouchDivAndAddToParent("touch-center",e),w.createTouchDivAndAddToParent("touch-right",e),w.createTouchDivAndAddToParent("touch-leftBottom",e),w.createTouchDivAndAddToParent("touch-bottom",e),w.createTouchDivAndAddToParent("touch-rightBottom",e),window.document.body.appendChild(e)}cancelTouches(){window.keyDown[40]=!1,window.keyDown[38]=!1,window.keyDown[37]=!1,window.keyDown[39]=!1,window.keyDown[55]=!1,window.lastKeyCodeDown=0}touchStart(e){(new Date).getTime(),this.startTimeStamp.getTime(),this.startTimeStamp=new Date,e.preventDefault(),e.stopPropagation(),this.currentBaseTouch=e.targetTouches[e.targetTouches.length-1],this.lastTouchMoveX=e.targetTouches[0].pageX,this.lastTouchMoveY=e.targetTouches[0].pageY,this.baseTouchMoveX=e.targetTouches[0].pageX,this.baseTouchMoveY=e.targetTouches[0].pageY,this.lastTouchMoveY>=0&&this.lastTouchMoveY<f&&(window.keyDown[38]=!0),this.lastTouchMoveY>=2*f&&(window.keyDown[40]=!0),this.lastTouchMoveX>=0&&this.lastTouchMoveX<g&&(window.keyDown[37]=!0),this.lastTouchMoveX>=2*g&&(window.keyDown[39]=!0)}touchMove(e){}touchEnd(e){}initialise(){document.addEventListener("touchstart",this.touchStart.bind(this),{passive:!1}),document.addEventListener("touchmove",this.touchMove.bind(this),!1),document.addEventListener("touchend",this.touchEnd.bind(this),!1)}},P=class{constructor(e,t,i,n){this.onMoveDown=n,this.onMoveLeft=e,this.onMoveRight=t,this.onMoveUp=i,window.keyDown=window.keyDown||{},w.isMobile()?(this.inputController=new A,this.inputController.initialise(),window.scrollTo(0,1)):this.inputController=new T}checkKeys(){window.keyDown[40]&&(window.keyDown[40]=!1,this.onMoveDown()),window.keyDown[37]&&(window.keyDown[37]=!1,this.onMoveLeft()),window.keyDown[39]&&(window.keyDown[39]=!1,this.onMoveRight()),window.keyDown[38]&&(window.keyDown[38]=!1,this.onMoveUp())}};function D(e){const t=e.piece,i=e.position.x/d,n=e.position.y/d;let o=e.position.x+t[0].length*d>a*d||e.position.x<0||e.position.y+t.length*d>l*d||e.position.y<0;if(!o)for(let e=0;e<t.length;e++)for(let s=0;s<t[e].length;s++)1===t[e][s]&&1===this.screenArrayController.getValue(e+n,s+i)&&(o=!0);return o}function C(){this.points+=10,this.speed=Math.max(this.speed-100,5)}function x(){this.screenArrayController.consolidatePiece(this.currentPiece),this.screenArrayController.removeCompleteLines(),this.currentPiece=this.newPiece,this.currentPiece.position.x=0,this.newPiece=w.getRandomPiece(this.canvasContext),this.newPiece.position.x=a*d-2*d}function k(){const e=w.getPieceDataCopied(this.currentPiece);e.position.x-=d,D.call(this,e)||this.currentPiece.moveLeft()}function M(){const e=w.getPieceDataCopied(this.currentPiece);e.position.x+=d,D.call(this,e)||this.currentPiece.moveRigth()}function L(){const e=w.getPieceDataCopied(this.currentPiece);e.position.y+=d,D.call(this,e)?x.call(this):this.currentPiece.moveDown()}function b(){const e=w.getPieceDataCopied(this.currentPiece);if(e.rotateRigth(),D.call(this,e))for(this.currentPiece.rotateRigth();D.call(this,this.currentPiece);)this.currentPiece.moveLeft();else this.currentPiece.rotateRigth()}function R(){this.canvasContext.font="18px serif",this.canvasContext.fillText(this.points,d*a-40,16)}new class{constructor(e){this.canvas=e,this.canvasContext=this.canvas.getContext("2d"),this.canvas.width=a*d,this.canvas.height=l*d,this.screenArrayController=new y(this.canvasContext,C.bind(this)),this.bindedMain=this.main.bind(this),this.ioController=new P(k.bind(this),M.bind(this),b.bind(this),L.bind(this)),window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame,this.points=0,this.speed=2e3,this.deltaTime=0,this.lastTime=0,this.newPiece=w.getRandomPiece(this.canvasContext),this.newPiece.position.x=a*d-2*d,this.currentPiece=w.getRandomPiece(this.canvasContext),this.main()}main(e=0){this.deltaTime+=e-this.lastTime,this.lastTime=e,this.canvasContext.clearRect(0,0,this.canvas.width,this.canvas.height),this.ioController.checkKeys(),this.renderScreen()}renderScreen(){this.deltaTime>=this.speed&&(L.call(this),this.deltaTime=0),this.screenArrayController.render(),this.currentPiece.render(),this.newPiece.render(),R.call(this),window.requestAnimationFrame(this.bindedMain)}}(document.getElementById("mainCanvas"))})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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d0IzRCxPQUFPNEQsNkJBQ2xDNUQsT0FBTzZELDBCQUE0QjdELE9BQU84RCx3QkFDMUM5RCxPQUFPK0Qsd0JBRVhqSyxLQUFLK0ksT0FBUyxFQUNkL0ksS0FBSzZGLE1QMkNRLElPMUNiN0YsS0FBS2tLLFVBQVksRUFDakJsSyxLQUFLbUssU0FBVyxFQUNoQm5LLEtBQUtzQyxTQUFXLEVBQU1FLGVBQWV4QyxLQUFLRCxlQUMxQ0MsS0FBS3NDLFNBQVNyQyxTQUFTQyxFQUFLa0MsRUFBYTFCLEVBQTJCLEVBQVpBLEVBQ3hEVixLQUFLa0osYUFBZSxFQUFNMUcsZUFBZXhDLEtBQUtELGVBQzlDQyxLQUFLMkosTUFDVCxDQUVBLElBQUFBLENBQUtTLEVBQU8sR0FDUnBLLEtBQUtrSyxXQUFhRSxFQUFPcEssS0FBS21LLFNBQzlCbkssS0FBS21LLFNBQVdDLEVBQ2hCcEssS0FBS0QsY0FBY3NLLFVBQVUsRUFBRyxFQUFHckssS0FBS3NKLE9BQU9FLE1BQU94SixLQUFLc0osT0FBT0csUUFDbEV6SixLQUFLNEosYUFBYWxCLFlBQ2xCMUksS0FBS3NLLGNBQ1QsQ0FFQSxZQUFBQSxHQUNRdEssS0FBS2tLLFdBQWFsSyxLQUFLNkYsUUFDdkIwQyxFQUFxQjVELEtBQUszRSxNQUMxQkEsS0FBS2tLLFVBQVksR0FFckJsSyxLQUFLNkksc0JBQXNCeEksU0FDM0JMLEtBQUtrSixhQUFhN0ksU0FDbEJMLEtBQUtzQyxTQUFTakMsU0FDZDhJLEVBQWF4RSxLQUFLM0UsTUFFbEJrRyxPQUFPMkQsc0JBQXNCN0osS0FBSzBKLFdBQ3RDLEdDcERvQjFHLFNBQVN1SCxlQUFlLGMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90ZXRyaXMvLi9zcmMvanMvcGllY2VzL1BpZWNlLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9waWVjZXMvTGluZS5qcyIsIndlYnBhY2s6Ly90ZXRyaXMvLi9zcmMvanMvcGllY2VzL0Nyb3NzLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9waWVjZXMvU3F1YXJlLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9waWVjZXMvTGVmdENyb3NzLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9waWVjZXMvTGVmdExpbmUuanMiLCJ3ZWJwYWNrOi8vdGV0cmlzLy4vc3JjL2pzL3BpZWNlcy9SaWdodENyb3NzLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9waWVjZXMvUmlnaHRMaW5lLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9VdGlscy5qcyIsIndlYnBhY2s6Ly90ZXRyaXMvLi9zcmMvanMvYW5pbWF0aW9ucy9MaW5lQW5pbWF0aW9uLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9hbmltYXRpb25zL0FuaW1hdGlvbkNvbnRyb2xsZXIuanMiLCJ3ZWJwYWNrOi8vdGV0cmlzLy4vc3JjL2pzL1NjcmVlbkFycmF5Q29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly90ZXRyaXMvLi9zcmMvanMvaW9Db250cm9sbGVyL0tleWJvYXJkQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly90ZXRyaXMvLi9zcmMvanMvaW9Db250cm9sbGVyL1RvdWNoQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly90ZXRyaXMvLi9zcmMvanMvaW9Db250cm9sbGVyL0lvQ29udHJvbGxlci5qcyIsIndlYnBhY2s6Ly90ZXRyaXMvLi9zcmMvanMvVGV0cmlzLmpzIiwid2VicGFjazovL3RldHJpcy8uL3NyYy9qcy9pbmRleC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFV0aWxzIGZyb20gXCIuLi9VdGlsc1wiO1xuaW1wb3J0IHsgUEVYRUxfSEVJR0hULFxuICAgICAgICAgUEVYRUxfV0lEVEggfSBmcm9tIFwiLi4vVXRpbHNcIjtcblxuY2xhc3MgUGllY2Uge1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhc0NvbnRleHQpIHtcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0ID0gY2FudmFzQ29udGV4dDtcbiAgICAgICAgdGhpcy5wb3NpdGlvbiA9IHsgeDogMCwgeTogMCB9OyBcbiAgICAgICAgdGhpcy5waWVjZSA9IFtdXG4gICAgfVxuXG4gICAgcmVuZGVyKCkge1xuICAgICAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5waWVjZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZm9yIChsZXQgaj0wOyBqPHRoaXMucGllY2VbaV0ubGVuZ3RoOyBqKyspIHsgXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMucGllY2VbaV1bal0gPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeCA9IHRoaXMucG9zaXRpb24ueDtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgeSA9IHRoaXMucG9zaXRpb24ueTtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgVXRpbHMuZHJhd1BleGVsKHRoaXMuY2FudmFzQ29udGV4dCwgeCArIGoqUEVYRUxfV0lEVEgsIHkgKyBpKlBFWEVMX0hFSUdIVCwgUEVYRUxfV0lEVEgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJvdGF0ZVJpZ3RoKCkge1xuICAgICAgICBjb25zdCByb3RhdGlvbiA9IFtdXG5cbiAgICAgICAgZm9yKGxldCBpPTA7IGk8dGhpcy5waWVjZVswXS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgY29uc3QgbmV3Q29sID0gW11cblxuICAgICAgICAgICAgZm9yKGxldCBqPXRoaXMucGllY2UubGVuZ3RoIC0gMTsgaj49MDsgai0tKSB7IFxuICAgICAgICAgICAgICAgIG5ld0NvbC5wdXNoKHRoaXMucGllY2Vbal1baV0pXG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJvdGF0aW9uLnB1c2gobmV3Q29sKVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5waWVjZSA9IHJvdGF0aW9uXG4gICAgfVxuXG4gICAgbW92ZURvd24oKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24ueSArPSBQRVhFTF9IRUlHSFQ7XG4gICAgfVxuXG4gICAgbW92ZUxlZnQoKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24ueCAtPSBQRVhFTF9XSURUSDtcbiAgICB9XG5cbiAgICBtb3ZlUmlndGgoKSB7XG4gICAgICAgIHRoaXMucG9zaXRpb24ueCArPSBQRVhFTF9XSURUSDtcbiAgICB9XG5cbiAgICBjaGVja0NvbGxpc2lvbigpIHtcblxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUGllY2U7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBQaWVjZSBmcm9tIFwiLi9QaWVjZVwiO1xuXG5jbGFzcyBMaW5lIGV4dGVuZHMgUGllY2Uge1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhc0NvbnRleHQpIHtcbiAgICAgICAgc3VwZXIoY2FudmFzQ29udGV4dCk7XG4gICAgICAgIHRoaXMucGllY2UgPSBbXTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDEsMSwxXSk7ICAgIFxuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTGluZTsiLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFBpZWNlIGZyb20gXCIuL1BpZWNlXCI7XG5cbmNsYXNzIENyb3NzIGV4dGVuZHMgUGllY2Uge1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhc0NvbnRleHQpIHtcbiAgICAgICAgc3VwZXIoY2FudmFzQ29udGV4dCk7XG5cbiAgICAgICAgdGhpcy5waWVjZSA9IFtdO1xuICAgICAgICB0aGlzLnBpZWNlLnB1c2goWzAsMSwwXSlcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDEsMV0pXG4gICAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBDcm9zczsiLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFBpZWNlIGZyb20gXCIuL1BpZWNlXCI7XG5cbmNsYXNzIFNxdWFyZSBleHRlbmRzIFBpZWNlIHtcbiAgICBjb25zdHJ1Y3RvcihjYW52YXNDb250ZXh0KSB7XG4gICAgICAgIHN1cGVyKGNhbnZhc0NvbnRleHQpO1xuICAgICAgICBcbiAgICAgICAgdGhpcy5waWVjZSA9IFtdO1xuICAgICAgICB0aGlzLnBpZWNlLnB1c2goWzEsMV0pO1xuICAgICAgICB0aGlzLnBpZWNlLnB1c2goWzEsMV0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU3F1YXJlOyIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUGllY2UgZnJvbSBcIi4vUGllY2VcIjtcblxuY2xhc3MgTGVmdENyb3NzIGV4dGVuZHMgUGllY2Uge1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhc0NvbnRleHQpIHtcbiAgICAgICAgc3VwZXIoY2FudmFzQ29udGV4dCk7XG5cbiAgICAgICAgdGhpcy5waWVjZSA9IFtdO1xuICAgICAgICB0aGlzLnBpZWNlLnB1c2goWzEsMF0pO1xuICAgICAgICB0aGlzLnBpZWNlLnB1c2goWzEsMV0pO1xuICAgICAgICB0aGlzLnBpZWNlLnB1c2goWzAsMV0pO1xuICAgIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgTGVmdENyb3NzOyIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUGllY2UgZnJvbSBcIi4vUGllY2VcIjtcblxuY2xhc3MgTGVmdExpbmUgZXh0ZW5kcyBQaWVjZSB7XG4gICAgY29uc3RydWN0b3IoY2FudmFzQ29udGV4dCkge1xuICAgICAgICBzdXBlcihjYW52YXNDb250ZXh0KTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMucGllY2UgPSBbXTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDFdKTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDBdKTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDBdKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IExlZnRMaW5lOyIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUGllY2UgZnJvbSBcIi4vUGllY2VcIjtcblxuY2xhc3MgUmlnaHRDcm9zcyBleHRlbmRzIFBpZWNlIHtcbiAgICBjb25zdHJ1Y3RvcihjYW52YXNDb250ZXh0KSB7XG4gICAgICAgIHN1cGVyKGNhbnZhc0NvbnRleHQpO1xuXG4gICAgICAgIHRoaXMucGllY2UgPSBbXTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFswLDFdKTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDFdKTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDBdKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJpZ2h0Q3Jvc3M7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBQaWVjZSBmcm9tIFwiLi9QaWVjZVwiO1xuXG5jbGFzcyBSaWdodExpbmUgZXh0ZW5kcyBQaWVjZSB7XG4gICAgY29uc3RydWN0b3IoY2FudmFzQ29udGV4dCkge1xuICAgICAgICBzdXBlcihjYW52YXNDb250ZXh0KTtcbiAgICAgICAgXG4gICAgICAgIHRoaXMucGllY2UgPSBbXTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFsxLDFdKTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFswLDFdKTtcbiAgICAgICAgdGhpcy5waWVjZS5wdXNoKFswLDFdKTsgICBcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFJpZ2h0TGluZTsiLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IExpbmUgZnJvbSBcIi4vcGllY2VzL0xpbmVcIjtcbmltcG9ydCBDcm9zcyBmcm9tIFwiLi9waWVjZXMvQ3Jvc3NcIjtcbmltcG9ydCBTcXVhcmUgZnJvbSBcIi4vcGllY2VzL1NxdWFyZVwiO1xuaW1wb3J0IExlZnRDcm9zcyBmcm9tIFwiLi9waWVjZXMvTGVmdENyb3NzXCI7XG5pbXBvcnQgTGVmdExpbmUgZnJvbSBcIi4vcGllY2VzL0xlZnRMaW5lXCI7XG5pbXBvcnQgUmlnaHRDcm9zcyBmcm9tIFwiLi9waWVjZXMvUmlnaHRDcm9zc1wiO1xuaW1wb3J0IFJpZ2h0TGluZSBmcm9tIFwiLi9waWVjZXMvUmlnaHRMaW5lXCI7XG5cbmNvbnN0IFV0aWxzID0ge1xuICAgIGRyYXdQZXhlbChjYW52YXNDb250ZXh0LCB4LCB5LCBwaXhlbFdpZHRoLCBmcmFtZSA9IDApIHtcbiAgICAgICAgY2FudmFzQ29udGV4dC5zYXZlKCk7XG4gICAgICAgIGNhbnZhc0NvbnRleHQudHJhbnNsYXRlKHgrcGl4ZWxXaWR0aC8yLCB5K3BpeGVsV2lkdGgvMik7XG5cbiAgICAgICAgaWYgKGZyYW1lKSB7XG4gICAgICAgICAgICBjYW52YXNDb250ZXh0LnNjYWxlKGZyYW1lLCBmcmFtZSk7XG4gICAgICAgICAgICBjYW52YXNDb250ZXh0LnJvdGF0ZShmcmFtZSAqIDAuMzUpO1xuICAgICAgICB9XG4gICAgICAgIGNhbnZhc0NvbnRleHQuc2hhZG93Q29sb3I9XCJ3aGl0ZVwiO1xuICAgICAgICBjYW52YXNDb250ZXh0LnNoYWRvd0JsdXIgPSBmcmFtZSAqIDEwO1xuXG4gICAgICAgIGNhbnZhc0NvbnRleHQuYmVnaW5QYXRoKCk7XG4gICAgICAgIGNhbnZhc0NvbnRleHQubW92ZVRvKC1waXhlbFdpZHRoLzIsIHBpeGVsV2lkdGgvMik7XG4gICAgICAgIGNhbnZhc0NvbnRleHQubGluZVRvKHBpeGVsV2lkdGgvMiwgcGl4ZWxXaWR0aC8yKTtcbiAgICAgICAgY2FudmFzQ29udGV4dC5saW5lVG8ocGl4ZWxXaWR0aC8yLCAtcGl4ZWxXaWR0aC8yKTtcbiAgICAgICAgY2FudmFzQ29udGV4dC5saW5lVG8oLXBpeGVsV2lkdGgvMiwgLXBpeGVsV2lkdGgvMik7XG4gICAgICAgIGNhbnZhc0NvbnRleHQubGluZVRvKC1waXhlbFdpZHRoLzIsIHBpeGVsV2lkdGgvMik7XG4gICAgICAgIFxuICAgICAgICBjYW52YXNDb250ZXh0LmxpbmVUbyhwaXhlbFdpZHRoLzIsIC1waXhlbFdpZHRoLzIpO1xuICAgICAgICBjYW52YXNDb250ZXh0LmZpbGwoKTtcbiAgICAgICAgY2FudmFzQ29udGV4dC5yZXN0b3JlKCk7XG4gICAgfSxcblxuICAgIGRyYXdQZXhlbHNMaW5lKGNhbnZhc0NvbnRleHQsIHgsIHksIHBpeGVsV2lkdGgsIGZyYW1lKSB7XG4gICAgICAgIGZvcihsZXQgaT0wOyBpPFNDUkVFTl9XSURUSDsgaSsrKSB7XG4gICAgICAgICAgICB0aGlzLmRyYXdQZXhlbChjYW52YXNDb250ZXh0LCB4ICsgKGkqUEVYRUxfV0lEVEgpLCB5LCBQRVhFTF9XSURUSCwgZnJhbWUpO1xuICAgICAgICB9XG4gICAgfSxcblxuICAgIGdldFBpZWNlRGF0YUNvcGllZChwaWVjZSkge1xuICAgICAgICBjb25zdCBuZXdQaWVjZSA9IG5ldyBwaWVjZS5fX3Byb3RvX18uY29uc3RydWN0b3JcblxuICAgICAgICBuZXdQaWVjZS5wb3NpdGlvbiA9IHsuLi5waWVjZS5wb3NpdGlvbn07XG4gICAgICAgIG5ld1BpZWNlLnBpZWNlID0gWy4uLnBpZWNlLnBpZWNlXTtcblxuICAgICAgICByZXR1cm4gbmV3UGllY2U7XG4gICAgfSxcbiAgICBcbiAgICBnZXRSYW5kb21QaWVjZShjYW52YXNDb250ZXh0KSB7XG4gICAgICAgIGxldCBvYmplY3RzID0gWyBMaW5lLCBTcXVhcmUsIENyb3NzLCBMZWZ0Q3Jvc3MsIExlZnRMaW5lLCBSaWdodENyb3NzLCBSaWdodExpbmUgXTtcbiAgICBcbiAgICAgICAgcmV0dXJuIG5ldyBvYmplY3RzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDcpXShjYW52YXNDb250ZXh0KTtcbiAgICB9LFxuXG4gICAgY3JlYXRlVG91Y2hEaXZBbmRBZGRUb1BhcmVudChjbGFzc25hbWUsIHBhcmVudCkge1xuICAgICAgICBsZXQgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jylcblx0XHRkaXYuY2xhc3NMaXN0LmFkZChjbGFzc25hbWUsJ3RvdWNoLWNlbGwnKVxuXG5cdFx0cGFyZW50LmFwcGVuZENoaWxkKGRpdik7XG4gICAgfSxcblxuICAgIGlzTW9iaWxlKCkge1xuICAgICAgICBjb25zdCB1YSA9IG5hdmlnYXRvci51c2VyQWdlbnQ7XG5cbiAgICAgICAgcmV0dXJuICh1YS5tYXRjaCgvQW5kcm9pZC9pKSB8fCB1YS5tYXRjaCgvQmxhY2tCZXJyeS9pKSB8fCB1YS5tYXRjaCgvaVBob25lfGlQYWR8aVBvZC9pKSB8fCB1YS5tYXRjaCgvT3BlcmEgTWluaS9pKSB8fCB1YS5tYXRjaCgvSUVNb2JpbGUvaSkpO1xuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IFNDUkVFTl9XSURUSCA9IDEwO1xuZXhwb3J0IGNvbnN0IFNDUkVFTl9IRUlHVEggPSAxNjtcbmV4cG9ydCBjb25zdCBTUEVFRCA9IDIwMDA7XG5leHBvcnQgY29uc3QgUEVYRUxfV0lEVEggPSAzMjtcbmV4cG9ydCBjb25zdCBQRVhFTF9IRUlHSFQgPSAzMjtcblxuZXhwb3J0IGNvbnN0IEtFWV9MRUZUID0gMzc7XG5leHBvcnQgY29uc3QgS0VZX1VQID0gMzg7XG5leHBvcnQgY29uc3QgS0VZX1JJR0hUID0gMzk7XG5leHBvcnQgY29uc3QgS0VZX0RPV04gPSA0MDtcbmV4cG9ydCBjb25zdCBLRVlfU1BBQ0UgPSA1NTtcblxuZXhwb3J0IGRlZmF1bHQgVXRpbHM7XG5cbiIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4uL1V0aWxzXCI7XG5pbXBvcnQgeyBQRVhFTF9XSURUSCB9IGZyb20gXCIuLi9VdGlsc1wiO1xuXG5jbGFzcyBMaW5lQW5pbWF0aW9uIHtcbiAgICBjb25zdHJ1Y3RvcihjYW52YXNDb250ZXh0LCB4LCB5LCBvbkRlc3Ryb3kpIHtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpeyB0aGlzLmRlc3Ryb3koKSB9LmJpbmQodGhpcyksIDUwMCk7XG4gICAgICAgIHRoaXMuZnJhbWUgPSAwO1xuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuICAgICAgICB0aGlzLm9uRGVzdHJveSA9IG9uRGVzdHJveTtcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0ID0gY2FudmFzQ29udGV4dDtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuZnJhbWUgKz0wLjA1O1xuICAgICAgICBVdGlscy5kcmF3UGV4ZWxzTGluZSh0aGlzLmNhbnZhc0NvbnRleHQsIHRoaXMueCwgdGhpcy55LCBQRVhFTF9XSURUSCwgdGhpcy5mcmFtZSk7XG4gICAgfVxuXG4gICAgZGVzdHJveSgpIHtcbiAgICAgICAgdGhpcy5vbkRlc3Ryb3koKTtcbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IExpbmVBbmltYXRpb247IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBMaW5lQW5pbWF0aW9uIGZyb20gXCIuL0xpbmVBbmltYXRpb25cIjtcblxuY2xhc3MgQW5pbWF0aW9uQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IoY2FudmFzQ29udGV4dCkge1xuICAgICAgICB0aGlzLmFuaW1hdGlvbnMgPSBbXTtcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0ID0gY2FudmFzQ29udGV4dDtcbiAgICB9XG5cbiAgICBjcmVhdGVSZW1vdmVMaW5lQW5pbWF0aW9uKHgsIHkpIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25zLnVuc2hpZnQobmV3IExpbmVBbmltYXRpb24odGhpcy5jYW52YXNDb250ZXh0LCB4LCB5LCB0aGlzLmRlc3Ryb3lMaW5lQW5pbWF0aW9uLmJpbmQodGhpcykpKTtcbiAgICB9XG5cbiAgICBkZXN0cm95TGluZUFuaW1hdGlvbigpIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25zLnBvcCgpO1xuICAgIH1cbiAgICBcbiAgICByZW5kZXIoKSB7XG4gICAgICAgIHRoaXMuYW5pbWF0aW9ucy5sZW5ndGggJiYgdGhpcy5hbmltYXRpb25zLmZvckVhY2goZWxlbWVudCA9PiB7XG4gICAgICAgICAgICBlbGVtZW50LnJlbmRlcigpO1xuICAgICAgICB9KTtcbiAgICBcbiAgICB9XG59XG5cblxuXG5leHBvcnQgZGVmYXVsdCBBbmltYXRpb25Db250cm9sbGVyOyIsIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBTQ1JFRU5fSEVJR1RILFxuICAgICAgICAgU0NSRUVOX1dJRFRILFxuICAgICAgICAgUEVYRUxfV0lEVEggfSBmcm9tIFwiLi9VdGlsc1wiXG5pbXBvcnQgVXRpbHMgZnJvbSBcIi4vVXRpbHNcIjtcbmltcG9ydCBBbmltYXRpb25Db250cm9sbGVyIGZyb20gXCIuL2FuaW1hdGlvbnMvQW5pbWF0aW9uQ29udHJvbGxlclwiO1xuXG5jbGFzcyBTY3JlZW5BcnJheUNvbnRyb2xsZXIge1xuICAgIGNvbnN0cnVjdG9yKGNhbnZhc0NvbnRleHQsIG9uQ29tcGxldGVMaW5lKSB7XG4gICAgICAgIHRoaXMuY2FudmFzQ29udGV4dCA9IGNhbnZhc0NvbnRleHQ7XG4gICAgICAgIHRoaXMuc2NyZWVuQXJyYXkgPSBuZXcgQXJyYXkoU0NSRUVOX0hFSUdUSCk7XG4gICAgICAgIGNyZWF0ZVNjcmVlblNlY29uZGFyeUFycmF5LmNhbGwodGhpcywgU0NSRUVOX1dJRFRIKTtcbiAgICAgICAgdGhpcy5hbmltYXRpb25Db250cm9sbGVyID0gbmV3IEFuaW1hdGlvbkNvbnRyb2xsZXIodGhpcy5jYW52YXNDb250ZXh0KTtcbiAgICAgICAgdGhpcy5vbkNvbXBsZXRlTGluZSA9IG9uQ29tcGxldGVMaW5lO1xuICAgIH1cblxuICAgIGdldFZhbHVlKHgsIHkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NyZWVuQXJyYXlbeF1beV07XG4gICAgfVxuXG4gICAgc2V0VmFsdWUoeCwgeSwgdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2NyZWVuQXJyYXlbeF1beV0gPSB2YWx1ZTtcbiAgICB9XG5cbiAgICByZW5kZXIoKSB7XG4gICAgICAgIGZvcihsZXQgaT0wOyBpPHRoaXMuc2NyZWVuQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGlmKCF0aGlzLmNoZWNrQ29tcGxldGVMaW5lKGkpKSB7XG4gICAgICAgICAgICAgICAgZm9yKGxldCBqPTA7IGo8dGhpcy5zY3JlZW5BcnJheVtpXS5sZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICBpZih0aGlzLnNjcmVlbkFycmF5W2ldW2pdID09PSAxKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBVdGlscy5kcmF3UGV4ZWwodGhpcy5jYW52YXNDb250ZXh0LCBqKlBFWEVMX1dJRFRILCBpKlBFWEVMX1dJRFRILCBQRVhFTF9XSURUSCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLmFuaW1hdGlvbkNvbnRyb2xsZXIucmVuZGVyKCk7XG4gICAgfVxuXG4gICAgY2hlY2tDb21wbGV0ZUxpbmUobGluZSkge1xuICAgICAgICBsZXQgZm91bmQgPSBmYWxzZSwgXG4gICAgICAgICAgICBpPTA7XG4gICAgXG4gICAgICAgIHdoaWxlKCFmb3VuZCAmJiBpPHRoaXMuc2NyZWVuQXJyYXlbbGluZV0ubGVuZ3RoKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5zY3JlZW5BcnJheVtsaW5lXVtpXSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXG4gICAgICAgIHJldHVybiAhZm91bmQ7XG4gICAgfVxuXG4gICAgY29uc29saWRhdGVQaWVjZShwaWVjZSkge1xuICAgICAgICBjb25zdCBwaWVjZUFycmF5ID0gcGllY2UucGllY2U7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRYID0gcGllY2UucG9zaXRpb24ueCAvUEVYRUxfV0lEVEg7XG4gICAgICAgIGNvbnN0IGN1cnJlbnRZID0gcGllY2UucG9zaXRpb24ueSAvUEVYRUxfV0lEVEg7XG4gICAgXG4gICAgICAgIGZvciAobGV0IGk9MDsgaTxwaWVjZUFycmF5Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBqPTA7IGo8cGllY2VBcnJheVtpXS5sZW5ndGg7IGorKykgeyBcbiAgICAgICAgICAgICAgICBpZiAocGllY2VBcnJheVtpXVtqXSA9PT0gMSkge1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnNldFZhbHVlKGkrY3VycmVudFksIGorY3VycmVudFgsIDEpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJlbW92ZUNvbXBsZXRlTGluZXMoKSB7XG4gICAgICAgIGZvcihsZXQgaT10aGlzLnNjcmVlbkFycmF5Lmxlbmd0aC0xOyBpPj0wOyBpLS0pIHtcbiAgICAgICAgICAgIGlmKHRoaXMuY2hlY2tDb21wbGV0ZUxpbmUoaSkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmFuaW1hdGlvbkNvbnRyb2xsZXIuY3JlYXRlUmVtb3ZlTGluZUFuaW1hdGlvbigwLCBpKlBFWEVMX1dJRFRIKTtcbiAgICAgICAgICAgICAgICB0aGlzLm9uQ29tcGxldGVMaW5lKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBcbiAgICBcbiAgICAgICAgZnVuY3Rpb24gcmVtb3ZlQ29tcGxldGVMaW5lKCkge1xuICAgICAgICAgICAgZm9yKGxldCBpPXRoaXMuc2NyZWVuQXJyYXkubGVuZ3RoLTE7IGk+PTA7IGktLSkge1xuICAgICAgICAgICAgICAgIGlmKHRoaXMuY2hlY2tDb21wbGV0ZUxpbmUoaSkpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVMaW5lKGkpO1xuICAgICAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKHRoaXMudGltZXIpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLnRpbWVyID0gc2V0SW50ZXJ2YWwodGhpcy5iaW5kZWRNb3ZlRG93biwgdGhpcy5zcGVlZCk7XG4gICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpKys7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNldFRpbWVvdXQocmVtb3ZlQ29tcGxldGVMaW5lLmJpbmQodGhpcyksNTAwKTtcbiAgICB9XG4gICAgXG4gICAgcmVtb3ZlTGluZShsaW5lKSB7XG4gICAgICAgIGxldCBpID0gbGluZTtcbiAgICAgICAgd2hpbGUoaT4wKSB7XG4gICAgICAgICAgICB0aGlzLnNjcmVlbkFycmF5W2ldID0gdGhpcy5zY3JlZW5BcnJheVtpLTFdO1xuICAgICAgICAgICAgaS0tO1xuICAgICAgICB9XG4gICAgXG4gICAgICAgIHRoaXMuc2NyZWVuQXJyYXlbMF0gPSBuZXcgQXJyYXkoU0NSRUVOX1dJRFRIKS5maWxsKDApO1xuICAgIH0gICBcbn1cblxuZnVuY3Rpb24gY3JlYXRlU2NyZWVuU2Vjb25kYXJ5QXJyYXkoc3ViQXJyYXlsZW5ndGgpIHtcbiAgICBmb3IgKGxldCBpPTA7IGk8dGhpcy5zY3JlZW5BcnJheS5sZW5ndGg7IGkrKykge1xuICAgICAgICB0aGlzLnNjcmVlbkFycmF5W2ldID0gbmV3IEFycmF5KHN1YkFycmF5bGVuZ3RoKS5maWxsKDApO1xuICAgIH1cbn0gIFxuXG5leHBvcnQgZGVmYXVsdCBTY3JlZW5BcnJheUNvbnRyb2xsZXI7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmNsYXNzIEtleWJvYXJkQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKG9uTW92ZUxlZnQsXG4gICAgICAgICAgICAgIG9uTW92ZVJpZ2h0LFxuICAgICAgICAgICAgICBvbk1vdmVVcCxcbiAgICAgICAgICAgICAgb25Nb3ZlRG93bikge1xuXG4gICAgdGhpcy5vbk1vdmVEb3duID0gb25Nb3ZlRG93bjtcbiAgICB0aGlzLm9uTW92ZUxlZnQgPSBvbk1vdmVMZWZ0O1xuICAgIHRoaXMub25Nb3ZlUmlnaHQgPSBvbk1vdmVSaWdodDtcbiAgICB0aGlzLm9uTW92ZVVwID0gb25Nb3ZlVXA7XG4gICAgd2luZG93LmtleURvd24gPSB3aW5kb3cua2V5RG93biB8fCB7fTtcblxuICAgIGRvY3VtZW50Lm9ua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgIGUgPSBlIHx8IHdpbmRvdy5ldmVudDtcbiAgICAgIHdpbmRvdy5rZXlEb3duW2Uua2V5Q29kZV0gPSB0cnVlO1xuICAgIH1cblxuICAgIGRvY3VtZW50Lm9ua2V5dXAgPSBmdW5jdGlvbihlKSB7XG4gICAgICBlID0gZSB8fCB3aW5kb3cuZXZlbnQ7XG4gICAgICB3aW5kb3cua2V5RG93bltlLmtleUNvZGVdID0gZmFsc2U7XG4gICAgfSAgXG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgS2V5Ym9hcmRDb250cm9sbGVyOyIsImltcG9ydCB7IEtFWV9ET1dOLCBLRVlfTEVGVCwgS0VZX1JJR0hULCBLRVlfVVAsIEtFWV9TUEFDRSB9IGZyb20gXCIuLi9VdGlsc1wiO1xuaW1wb3J0IFV0aWxzIGZyb20gXCIuLi9VdGlsc1wiO1xuXG5sZXQgX1RPVUNIUkVTT0xVVElPTiA9IDE1MDtcbmNvbnN0IFNDUkVFTl9SRVNfWCA9IHdpbmRvdy5pbm5lcldpZHRoIC8gMztcbmNvbnN0IFNDUkVFTl9SRVNfWSA9IHdpbmRvdy5pbm5lckhlaWdodCAvIDM7XG5cbmNsYXNzIFRvdWNoQ29udHJvbGxlciB7XG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdHRoaXMuc3RhcnRUaW1lU3RhbXAgPSBuZXcgRGF0ZSgpO1xuXHRcdHRoaXMubGFzdFRvdWNoTW92ZVggPSAwO1xuXHRcdHRoaXMubGFzdFRvdWNoTW92ZVkgPSAwO1xuXHRcdHRoaXMuYmFzZVRvdWNoTW92ZVggPSAwO1xuXHRcdHRoaXMuYmFzZVRvdWNoTW92ZVkgPSAwO1xuICAgICAgICB0aGlzLmN1cnJlbnRCYXNlVG91Y2g9bnVsbDsgIFxuICAgICAgICB3aW5kb3cua2V5RG93biA9IHdpbmRvdy5rZXlEb3duIHx8IHt9O1xuXG5cdFx0Y29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jylcblx0XHRjb250YWluZXIuY2xhc3NMaXN0LmFkZCgndG91Y2gtY2VsbC1jb250YWluZXInKVxuXG5cdFx0VXRpbHMuY3JlYXRlVG91Y2hEaXZBbmRBZGRUb1BhcmVudCgndG91Y2gtbGVmdFRvcCcsIGNvbnRhaW5lcik7XG5cdFx0VXRpbHMuY3JlYXRlVG91Y2hEaXZBbmRBZGRUb1BhcmVudCgndG91Y2gtdG9wJywgY29udGFpbmVyKTtcblx0XHRVdGlscy5jcmVhdGVUb3VjaERpdkFuZEFkZFRvUGFyZW50KCd0b3VjaC1yaWdodFRvcCcsIGNvbnRhaW5lcik7XG5cdFx0XG5cdFx0VXRpbHMuY3JlYXRlVG91Y2hEaXZBbmRBZGRUb1BhcmVudCgndG91Y2gtbGVmdCcsIGNvbnRhaW5lcik7XG5cdFx0VXRpbHMuY3JlYXRlVG91Y2hEaXZBbmRBZGRUb1BhcmVudCgndG91Y2gtY2VudGVyJywgY29udGFpbmVyKTtcblx0XHRVdGlscy5jcmVhdGVUb3VjaERpdkFuZEFkZFRvUGFyZW50KCd0b3VjaC1yaWdodCcsIGNvbnRhaW5lcik7XG5cdFx0XG5cdFx0VXRpbHMuY3JlYXRlVG91Y2hEaXZBbmRBZGRUb1BhcmVudCgndG91Y2gtbGVmdEJvdHRvbScsIGNvbnRhaW5lcik7XG5cdFx0VXRpbHMuY3JlYXRlVG91Y2hEaXZBbmRBZGRUb1BhcmVudCgndG91Y2gtYm90dG9tJywgY29udGFpbmVyKTtcblx0XHRVdGlscy5jcmVhdGVUb3VjaERpdkFuZEFkZFRvUGFyZW50KCd0b3VjaC1yaWdodEJvdHRvbScsIGNvbnRhaW5lcik7XG5cblx0XHR3aW5kb3cuZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChjb250YWluZXIpO1xuXHR9XG5cblx0Y2FuY2VsVG91Y2hlcygpIHtcblx0XHR3aW5kb3cua2V5RG93bltLRVlfRE9XTl0gPSBmYWxzZTtcblx0XHR3aW5kb3cua2V5RG93bltLRVlfVVBdID0gZmFsc2U7XG5cdFx0d2luZG93LmtleURvd25bS0VZX0xFRlRdID0gZmFsc2U7XG5cdFx0d2luZG93LmtleURvd25bS0VZX1JJR0hUXSA9IGZhbHNlO1xuXHRcdHdpbmRvdy5rZXlEb3duW0tFWV9TUEFDRV0gPSBmYWxzZTtcblx0XHR3aW5kb3cubGFzdEtleUNvZGVEb3duID0gMDtcblx0fVxuXHRcblx0dG91Y2hTdGFydChldmVudCkge1xuXHRcdHZhciB0aW1lU3RhbXAgPSBuZXcgRGF0ZSgpLFxuXHRcdFx0dCA9IHRpbWVTdGFtcC5nZXRUaW1lKCkgLSB0aGlzLnN0YXJ0VGltZVN0YW1wLmdldFRpbWUoKTtcblx0XG5cdFx0dGhpcy5zdGFydFRpbWVTdGFtcCA9IG5ldyBEYXRlKCk7XG5cdFx0ICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdCAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcblx0XHR0aGlzLmN1cnJlbnRCYXNlVG91Y2ggPSBldmVudC50YXJnZXRUb3VjaGVzW2V2ZW50LnRhcmdldFRvdWNoZXMubGVuZ3RoLTFdO1xuXHRcblx0XHR0aGlzLmxhc3RUb3VjaE1vdmVYID0gZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5wYWdlWDtcblx0XHR0aGlzLmxhc3RUb3VjaE1vdmVZID0gZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5wYWdlWTtcblx0XHR0aGlzLmJhc2VUb3VjaE1vdmVYID0gZXZlbnQudGFyZ2V0VG91Y2hlc1swXS5wYWdlWDtcbiAgICAgICAgdGhpcy5iYXNlVG91Y2hNb3ZlWSA9IGV2ZW50LnRhcmdldFRvdWNoZXNbMF0ucGFnZVk7XG4gICAgICAgIFxuICAgICAgICBpZiAodGhpcy5sYXN0VG91Y2hNb3ZlWSA+PSAwICYmIHRoaXMubGFzdFRvdWNoTW92ZVkgPCBTQ1JFRU5fUkVTX1kpIHsgXG4gICAgICAgICAgICB3aW5kb3cua2V5RG93bltLRVlfVVBdID0gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLmxhc3RUb3VjaE1vdmVZID49ICgyICogU0NSRUVOX1JFU19ZKSkgeyBcbiAgICAgICAgICAgIHdpbmRvdy5rZXlEb3duW0tFWV9ET1dOXSA9IHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAodGhpcy5sYXN0VG91Y2hNb3ZlWCA+PSAwICYmIHRoaXMubGFzdFRvdWNoTW92ZVggPCBTQ1JFRU5fUkVTX1gpIHsgXG4gICAgICAgICAgICB3aW5kb3cua2V5RG93bltLRVlfTEVGVF0gPSB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHRoaXMubGFzdFRvdWNoTW92ZVggPj0gKDIgKiBTQ1JFRU5fUkVTX1gpKSB7IFxuICAgICAgICAgICAgd2luZG93LmtleURvd25bS0VZX1JJR0hUXSA9IHRydWU7XG4gICAgICAgIH1cdH1cblx0XG5cdHRvdWNoTW92ZShldmVudCkge1xuXG5cdH1cblx0XG5cdHRvdWNoRW5kKGV2ZW50KSB7XG5cdH1cblxuXHRpbml0aWFsaXNlKCkge1xuICAgICAgICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgdGhpcy50b3VjaFN0YXJ0LmJpbmQodGhpcyksIHsgcGFzc2l2ZTogZmFsc2UgfSk7XG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIHRoaXMudG91Y2hNb3ZlLmJpbmQodGhpcyksIGZhbHNlKTsgXG4gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgdGhpcy50b3VjaEVuZC5iaW5kKHRoaXMpLCBmYWxzZSk7IFxuXHR9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFRvdWNoQ29udHJvbGxlcjsiLCJpbXBvcnQgVXRpbHMgIGZyb20gXCIuLi9VdGlsc1wiO1xuaW1wb3J0IHsgS0VZX0RPV04sIEtFWV9MRUZULCBLRVlfUklHSFQsIEtFWV9VUCB9IGZyb20gXCIuLi9VdGlsc1wiO1xuaW1wb3J0IEtleWJvYXJkQ29udHJvbGxlciBmcm9tIFwiLi9LZXlib2FyZENvbnRyb2xsZXJcIjtcbmltcG9ydCBUb3VjaENvbnRyb2xsZXIgZnJvbSBcIi4vVG91Y2hDb250cm9sbGVyXCI7XG5cbmNsYXNzIElvQ29udHJvbGxlciB7XG4gICAgY29uc3RydWN0b3IobW92ZUN1cnJlbnRQaWVjZUxlZnQsXG4gICAgICAgICAgICAgICAgbW92ZUN1cnJlbnRQaWVjZVJpZ2h0LFxuICAgICAgICAgICAgICAgIHJvdGF0ZUN1cnJlbnRQaWVjZVJpZ2h0LFxuICAgICAgICAgICAgICAgIG1vdmVDdXJyZW50UGllY2VEb3duKSB7XG4gICAgICAgIHRoaXMub25Nb3ZlRG93biA9IG1vdmVDdXJyZW50UGllY2VEb3duO1xuICAgICAgICB0aGlzLm9uTW92ZUxlZnQgPSBtb3ZlQ3VycmVudFBpZWNlTGVmdDtcbiAgICAgICAgdGhpcy5vbk1vdmVSaWdodCA9IG1vdmVDdXJyZW50UGllY2VSaWdodDtcbiAgICAgICAgdGhpcy5vbk1vdmVVcCA9IHJvdGF0ZUN1cnJlbnRQaWVjZVJpZ2h0O1xuICAgICAgICB3aW5kb3cua2V5RG93biA9IHdpbmRvdy5rZXlEb3duIHx8IHt9O1xuICAgICAgICBcbiAgICAgICAgaWYgKFV0aWxzLmlzTW9iaWxlKCkpIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRDb250cm9sbGVyID0gbmV3IFRvdWNoQ29udHJvbGxlcigpO1xuICAgICAgICAgICAgdGhpcy5pbnB1dENvbnRyb2xsZXIuaW5pdGlhbGlzZSgpO1xuICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsMSlcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuaW5wdXRDb250cm9sbGVyID0gbmV3IEtleWJvYXJkQ29udHJvbGxlcigpO1xuICAgICAgICB9XG5cbiAgICB9XG5cbiAgICBjaGVja0tleXMoKSB7XG4gICAgICAgIGlmICh3aW5kb3cua2V5RG93bltLRVlfRE9XTl0pIHtcbiAgICAgICAgICAgIHdpbmRvdy5rZXlEb3duW0tFWV9ET1dOXSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5vbk1vdmVEb3duKCk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHdpbmRvdy5rZXlEb3duW0tFWV9MRUZUXSkge1xuICAgICAgICAgICAgd2luZG93LmtleURvd25bS0VZX0xFRlRdID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm9uTW92ZUxlZnQoKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAod2luZG93LmtleURvd25bS0VZX1JJR0hUXSkge1xuICAgICAgICAgICAgd2luZG93LmtleURvd25bS0VZX1JJR0hUXSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5vbk1vdmVSaWdodCgpO1xuICAgICAgICB9XG4gICAgICAgIGlmICh3aW5kb3cua2V5RG93bltLRVlfVVBdKSB7XG4gICAgICAgICAgICB3aW5kb3cua2V5RG93bltLRVlfVVBdID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLm9uTW92ZVVwKCk7XG4gICAgICAgIH1cbiAgICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IElvQ29udHJvbGxlcjsiLCJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFV0aWxzICBmcm9tIFwiLi9VdGlsc1wiO1xuaW1wb3J0IFNjcmVlbkFycmF5Q29udHJvbGxlciBmcm9tIFwiLi9TY3JlZW5BcnJheUNvbnRyb2xsZXJcIlxuaW1wb3J0IHsgU0NSRUVOX1dJRFRILFxuICAgIFNDUkVFTl9IRUlHVEgsXG4gICAgU1BFRUQsXG4gICAgUEVYRUxfV0lEVEggfSBmcm9tIFwiLi9VdGlsc1wiO1xuaW1wb3J0IElvQ29udHJvbGxlciBmcm9tIFwiLi9pb0NvbnRyb2xsZXIvSW9Db250cm9sbGVyXCI7XG5cbmNsYXNzIFRldHJpcyB7XG4gICAgY29uc3RydWN0b3IgKGNhbnZhcykge1xuICAgICAgICB0aGlzLmNhbnZhcyA9IGNhbnZhcztcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0ID0gdGhpcy5jYW52YXMuZ2V0Q29udGV4dChcIjJkXCIpO1xuICAgICAgICB0aGlzLmNhbnZhcy53aWR0aCA9IFNDUkVFTl9XSURUSCAqIFBFWEVMX1dJRFRIO1xuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSBTQ1JFRU5fSEVJR1RIICogUEVYRUxfV0lEVEg7XG4gICAgICAgIHRoaXMuc2NyZWVuQXJyYXlDb250cm9sbGVyID0gbmV3IFNjcmVlbkFycmF5Q29udHJvbGxlcih0aGlzLmNhbnZhc0NvbnRleHQsIG9uTGluZUNvbXBsZXRlZC5iaW5kKHRoaXMpKTtcbiAgICAgICAgdGhpcy5iaW5kZWRNYWluID0gdGhpcy5tYWluLmJpbmQodGhpcyk7XG4gICAgICAgIHRoaXMuaW9Db250cm9sbGVyID0gbmV3IElvQ29udHJvbGxlcihtb3ZlQ3VycmVudFBpZWNlTGVmdC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZUN1cnJlbnRQaWVjZVJpZ2h0LmJpbmQodGhpcyksXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3RhdGVDdXJyZW50UGllY2VSaWdodC5iaW5kKHRoaXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW92ZUN1cnJlbnRQaWVjZURvd24uYmluZCh0aGlzKSk7XG5cbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IHdpbmRvdy53ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHwgd2luZG93Lm9SZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgIHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZTtcblxuICAgICAgICB0aGlzLnBvaW50cyA9IDA7XG4gICAgICAgIHRoaXMuc3BlZWQgPSBTUEVFRDtcbiAgICAgICAgdGhpcy5kZWx0YVRpbWUgPSAwO1xuICAgICAgICB0aGlzLmxhc3RUaW1lID0gMDtcbiAgICAgICAgdGhpcy5uZXdQaWVjZSA9IFV0aWxzLmdldFJhbmRvbVBpZWNlKHRoaXMuY2FudmFzQ29udGV4dCk7XG4gICAgICAgIHRoaXMubmV3UGllY2UucG9zaXRpb24ueCA9IChTQ1JFRU5fV0lEVEgqUEVYRUxfV0lEVEgpIC0gUEVYRUxfV0lEVEgqMjtcbiAgICAgICAgdGhpcy5jdXJyZW50UGllY2UgPSBVdGlscy5nZXRSYW5kb21QaWVjZSh0aGlzLmNhbnZhc0NvbnRleHQpO1xuICAgICAgICB0aGlzLm1haW4oKTtcbiAgICB9XG5cbiAgICBtYWluKHRpbWUgPSAwKSB7XG4gICAgICAgIHRoaXMuZGVsdGFUaW1lICs9IHRpbWUgLSB0aGlzLmxhc3RUaW1lO1xuICAgICAgICB0aGlzLmxhc3RUaW1lID0gdGltZTtcbiAgICAgICAgdGhpcy5jYW52YXNDb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgdGhpcy5pb0NvbnRyb2xsZXIuY2hlY2tLZXlzKCk7XG4gICAgICAgIHRoaXMucmVuZGVyU2NyZWVuKCk7XG4gICAgfVxuXG4gICAgcmVuZGVyU2NyZWVuKCkge1xuICAgICAgICBpZiAodGhpcy5kZWx0YVRpbWUgPj0gdGhpcy5zcGVlZCkge1xuICAgICAgICAgICAgbW92ZUN1cnJlbnRQaWVjZURvd24uY2FsbCh0aGlzKTtcbiAgICAgICAgICAgIHRoaXMuZGVsdGFUaW1lID0gMDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLnNjcmVlbkFycmF5Q29udHJvbGxlci5yZW5kZXIoKTtcbiAgICAgICAgdGhpcy5jdXJyZW50UGllY2UucmVuZGVyKCk7XG4gICAgICAgIHRoaXMubmV3UGllY2UucmVuZGVyKCk7XG4gICAgICAgIHJlbmRlclBvaW50cy5jYWxsKHRoaXMpO1xuXG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUodGhpcy5iaW5kZWRNYWluKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIGNoZWNrQ29sbGlzaW9uKHRlc3RQaWVjZSkge1xuICAgIGNvbnN0IHBpZWNlQXJyYXkgPSB0ZXN0UGllY2UucGllY2U7XG4gICAgY29uc3QgY3VycmVudFggPSB0ZXN0UGllY2UucG9zaXRpb24ueCAvIFBFWEVMX1dJRFRIO1xuICAgIGNvbnN0IGN1cnJlbnRZID0gdGVzdFBpZWNlLnBvc2l0aW9uLnkgLyBQRVhFTF9XSURUSDtcbiAgICBsZXQgY29sbGlzaW9uID0gKHRlc3RQaWVjZS5wb3NpdGlvbi54ICsgcGllY2VBcnJheVswXS5sZW5ndGgqUEVYRUxfV0lEVEgpID4gU0NSRUVOX1dJRFRIKlBFWEVMX1dJRFRIIHx8IFxuICAgICAgICAgICAgdGVzdFBpZWNlLnBvc2l0aW9uLnggPCAwIHx8IFxuICAgICAgICAgICAgKHRlc3RQaWVjZS5wb3NpdGlvbi55ICsgcGllY2VBcnJheS5sZW5ndGgqUEVYRUxfV0lEVEgpID4gU0NSRUVOX0hFSUdUSCpQRVhFTF9XSURUSCB8fCBcbiAgICAgICAgICAgIHRlc3RQaWVjZS5wb3NpdGlvbi55IDwwO1xuXG4gICAgaWYgKCFjb2xsaXNpb24pIHtcbiAgICAgICAgZm9yIChsZXQgaT0wOyBpPHBpZWNlQXJyYXkubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGZvciAobGV0IGo9MDsgajxwaWVjZUFycmF5W2ldLmxlbmd0aDsgaisrKSB7IFxuICAgICAgICAgICAgICAgIGlmIChwaWVjZUFycmF5W2ldW2pdID09PSAxICYmIHRoaXMuc2NyZWVuQXJyYXlDb250cm9sbGVyLmdldFZhbHVlKGkrY3VycmVudFksaitjdXJyZW50WCkgPT09IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgY29sbGlzaW9uID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gY29sbGlzaW9uO1xufVxuXG5mdW5jdGlvbiBvbkxpbmVDb21wbGV0ZWQoKSB7XG4gICAgdGhpcy5wb2ludHMgKz0gMTA7XG4gICAgdGhpcy5zcGVlZCA9IE1hdGgubWF4KHRoaXMuc3BlZWQtMTAwLCA1KTtcbn1cblxuZnVuY3Rpb24gYXBwbHlDb2xsaXNpb24oKSB7XG4gICAgdGhpcy5zY3JlZW5BcnJheUNvbnRyb2xsZXIuY29uc29saWRhdGVQaWVjZSh0aGlzLmN1cnJlbnRQaWVjZSk7XG4gICAgdGhpcy5zY3JlZW5BcnJheUNvbnRyb2xsZXIucmVtb3ZlQ29tcGxldGVMaW5lcygpO1xuICAgIHRoaXMuY3VycmVudFBpZWNlID0gdGhpcy5uZXdQaWVjZTtcbiAgICB0aGlzLmN1cnJlbnRQaWVjZS5wb3NpdGlvbi54ID0gMDtcbiAgICB0aGlzLm5ld1BpZWNlID0gVXRpbHMuZ2V0UmFuZG9tUGllY2UodGhpcy5jYW52YXNDb250ZXh0KTtcbiAgICB0aGlzLm5ld1BpZWNlLnBvc2l0aW9uLnggPSAoU0NSRUVOX1dJRFRIKlBFWEVMX1dJRFRIKSAtIFBFWEVMX1dJRFRIKjI7XG59XG5cbmZ1bmN0aW9uIG1vdmVDdXJyZW50UGllY2VMZWZ0KCkge1xuICAgIGNvbnN0IHRlc3RQaWVjZSA9IFV0aWxzLmdldFBpZWNlRGF0YUNvcGllZCh0aGlzLmN1cnJlbnRQaWVjZSk7XG5cbiAgICB0ZXN0UGllY2UucG9zaXRpb24ueCAtPSBQRVhFTF9XSURUSDtcbiAgICBpZighY2hlY2tDb2xsaXNpb24uY2FsbCh0aGlzLCB0ZXN0UGllY2UpKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFBpZWNlLm1vdmVMZWZ0KCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBtb3ZlQ3VycmVudFBpZWNlUmlnaHQoKSB7XG4gICAgY29uc3QgdGVzdFBpZWNlID0gVXRpbHMuZ2V0UGllY2VEYXRhQ29waWVkKHRoaXMuY3VycmVudFBpZWNlKTtcbiAgICBcbiAgICB0ZXN0UGllY2UucG9zaXRpb24ueCArPSBQRVhFTF9XSURUSDtcbiAgICBpZighY2hlY2tDb2xsaXNpb24uY2FsbCh0aGlzLCB0ZXN0UGllY2UpKSB7XG4gICAgICAgIHRoaXMuY3VycmVudFBpZWNlLm1vdmVSaWd0aCgpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gbW92ZUN1cnJlbnRQaWVjZURvd24oKSB7XG4gICAgY29uc3QgdGVzdFBpZWNlID0gVXRpbHMuZ2V0UGllY2VEYXRhQ29waWVkKHRoaXMuY3VycmVudFBpZWNlKTtcblxuICAgIHRlc3RQaWVjZS5wb3NpdGlvbi55ICs9IFBFWEVMX1dJRFRIO1xuICAgIGlmKCFjaGVja0NvbGxpc2lvbi5jYWxsKHRoaXMsIHRlc3RQaWVjZSkpIHtcbiAgICAgICAgdGhpcy5jdXJyZW50UGllY2UubW92ZURvd24oKTtcbiAgICB9IGVsc2Uge1xuICAgICAgICBhcHBseUNvbGxpc2lvbi5jYWxsKHRoaXMpO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gcm90YXRlQ3VycmVudFBpZWNlUmlnaHQoKSB7XG4gICAgY29uc3QgdGVzdFBpZWNlID0gVXRpbHMuZ2V0UGllY2VEYXRhQ29waWVkKHRoaXMuY3VycmVudFBpZWNlKTtcblxuICAgIHRlc3RQaWVjZS5yb3RhdGVSaWd0aCgpXG4gICAgaWYoIWNoZWNrQ29sbGlzaW9uLmNhbGwodGhpcywgdGVzdFBpZWNlKSkge1xuICAgICAgICB0aGlzLmN1cnJlbnRQaWVjZS5yb3RhdGVSaWd0aCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY3VycmVudFBpZWNlLnJvdGF0ZVJpZ3RoKCk7XG4gICAgICAgIHdoaWxlIChjaGVja0NvbGxpc2lvbi5jYWxsKHRoaXMsIHRoaXMuY3VycmVudFBpZWNlKSkge1xuICAgICAgICAgICAgdGhpcy5jdXJyZW50UGllY2UubW92ZUxlZnQoKTtcbiAgICAgICAgfVxuICAgIH1cbn1cblxuZnVuY3Rpb24gcmVuZGVyUG9pbnRzKCkge1xuICAgIHRoaXMuY2FudmFzQ29udGV4dC5mb250ID0gXCIxOHB4IHNlcmlmXCI7XG4gICAgdGhpcy5jYW52YXNDb250ZXh0LmZpbGxUZXh0KHRoaXMucG9pbnRzLCBQRVhFTF9XSURUSCpTQ1JFRU5fV0lEVEggLSA0MCwgMTYpO1xufVxuXG5leHBvcnQgZGVmYXVsdCBUZXRyaXM7IiwiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBUZXRyaXMgZnJvbSBcIi4vVGV0cmlzXCI7XG5cbmxldCB0ZXRyaXMgPSBuZXcgVGV0cmlzKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluQ2FudmFzJykpO1xuXG4iXSwibmFtZXMiOlsiY29uc3RydWN0b3IiLCJjYW52YXNDb250ZXh0IiwidGhpcyIsInBvc2l0aW9uIiwieCIsInkiLCJwaWVjZSIsInJlbmRlciIsImkiLCJsZW5ndGgiLCJqIiwiZHJhd1BleGVsIiwiUEVYRUxfV0lEVEgiLCJQRVhFTF9IRUlHSFQiLCJyb3RhdGVSaWd0aCIsInJvdGF0aW9uIiwibmV3Q29sIiwicHVzaCIsIm1vdmVEb3duIiwibW92ZUxlZnQiLCJtb3ZlUmlndGgiLCJjaGVja0NvbGxpc2lvbiIsInN1cGVyIiwiVXRpbHMiLCJwaXhlbFdpZHRoIiwiZnJhbWUiLCJzYXZlIiwidHJhbnNsYXRlIiwic2NhbGUiLCJyb3RhdGUiLCJzaGFkb3dDb2xvciIsInNoYWRvd0JsdXIiLCJiZWdpblBhdGgiLCJtb3ZlVG8iLCJsaW5lVG8iLCJmaWxsIiwicmVzdG9yZSIsImRyYXdQZXhlbHNMaW5lIiwiU0NSRUVOX1dJRFRIIiwiZ2V0UGllY2VEYXRhQ29waWVkIiwibmV3UGllY2UiLCJfX3Byb3RvX18iLCJnZXRSYW5kb21QaWVjZSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImNyZWF0ZVRvdWNoRGl2QW5kQWRkVG9QYXJlbnQiLCJjbGFzc25hbWUiLCJwYXJlbnQiLCJkaXYiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJjbGFzc0xpc3QiLCJhZGQiLCJhcHBlbmRDaGlsZCIsImlzTW9iaWxlIiwidWEiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJtYXRjaCIsIlNDUkVFTl9IRUlHVEgiLCJvbkRlc3Ryb3kiLCJzZXRUaW1lb3V0IiwiZGVzdHJveSIsImJpbmQiLCJhbmltYXRpb25zIiwiY3JlYXRlUmVtb3ZlTGluZUFuaW1hdGlvbiIsInVuc2hpZnQiLCJkZXN0cm95TGluZUFuaW1hdGlvbiIsInBvcCIsImZvckVhY2giLCJlbGVtZW50IiwiY3JlYXRlU2NyZWVuU2Vjb25kYXJ5QXJyYXkiLCJzdWJBcnJheWxlbmd0aCIsInNjcmVlbkFycmF5IiwiQXJyYXkiLCJvbkNvbXBsZXRlTGluZSIsImNhbGwiLCJhbmltYXRpb25Db250cm9sbGVyIiwiZ2V0VmFsdWUiLCJzZXRWYWx1ZSIsInZhbHVlIiwiY2hlY2tDb21wbGV0ZUxpbmUiLCJsaW5lIiwiZm91bmQiLCJjb25zb2xpZGF0ZVBpZWNlIiwicGllY2VBcnJheSIsImN1cnJlbnRYIiwiY3VycmVudFkiLCJyZW1vdmVDb21wbGV0ZUxpbmVzIiwicmVtb3ZlTGluZSIsImNsZWFySW50ZXJ2YWwiLCJ0aW1lciIsInNldEludGVydmFsIiwiYmluZGVkTW92ZURvd24iLCJzcGVlZCIsIm9uTW92ZUxlZnQiLCJvbk1vdmVSaWdodCIsIm9uTW92ZVVwIiwib25Nb3ZlRG93biIsIndpbmRvdyIsImtleURvd24iLCJvbmtleWRvd24iLCJlIiwiZXZlbnQiLCJrZXlDb2RlIiwib25rZXl1cCIsIlNDUkVFTl9SRVNfWCIsImlubmVyV2lkdGgiLCJTQ1JFRU5fUkVTX1kiLCJpbm5lckhlaWdodCIsInN0YXJ0VGltZVN0YW1wIiwiRGF0ZSIsImxhc3RUb3VjaE1vdmVYIiwibGFzdFRvdWNoTW92ZVkiLCJiYXNlVG91Y2hNb3ZlWCIsImJhc2VUb3VjaE1vdmVZIiwiY3VycmVudEJhc2VUb3VjaCIsImNvbnRhaW5lciIsImJvZHkiLCJjYW5jZWxUb3VjaGVzIiwibGFzdEtleUNvZGVEb3duIiwidG91Y2hTdGFydCIsImdldFRpbWUiLCJwcmV2ZW50RGVmYXVsdCIsInN0b3BQcm9wYWdhdGlvbiIsInRhcmdldFRvdWNoZXMiLCJwYWdlWCIsInBhZ2VZIiwidG91Y2hNb3ZlIiwidG91Y2hFbmQiLCJpbml0aWFsaXNlIiwiYWRkRXZlbnRMaXN0ZW5lciIsInBhc3NpdmUiLCJtb3ZlQ3VycmVudFBpZWNlTGVmdCIsIm1vdmVDdXJyZW50UGllY2VSaWdodCIsInJvdGF0ZUN1cnJlbnRQaWVjZVJpZ2h0IiwibW92ZUN1cnJlbnRQaWVjZURvd24iLCJpbnB1dENvbnRyb2xsZXIiLCJzY3JvbGxUbyIsImNoZWNrS2V5cyIsInRlc3RQaWVjZSIsImNvbGxpc2lvbiIsInNjcmVlbkFycmF5Q29udHJvbGxlciIsIm9uTGluZUNvbXBsZXRlZCIsInBvaW50cyIsIm1heCIsImFwcGx5Q29sbGlzaW9uIiwiY3VycmVudFBpZWNlIiwicmVuZGVyUG9pbnRzIiwiZm9udCIsImZpbGxUZXh0IiwiY2FudmFzIiwiZ2V0Q29udGV4dCIsIndpZHRoIiwiaGVpZ2h0IiwiYmluZGVkTWFpbiIsIm1haW4iLCJpb0NvbnRyb2xsZXIiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJ3ZWJraXRSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJtb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJvUmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJkZWx0YVRpbWUiLCJsYXN0VGltZSIsInRpbWUiLCJjbGVhclJlY3QiLCJyZW5kZXJTY3JlZW4iLCJnZXRFbGVtZW50QnlJZCJdLCJzb3VyY2VSb290IjoiIn0=